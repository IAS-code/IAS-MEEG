<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IAS Demo &mdash; IAS  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Documentation" href="api.html" />
    <link rel="prev" title="IAS algorithm" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> IAS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">IAS Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">IAS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>IAS Demo</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/example.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ias-demo">
<span id="example"></span><h1>IAS Demo<a class="headerlink" href="#ias-demo" title="Permalink to this headline">¶</a></h1>
<p>This is a demo for testing the Iterative Alternating Sequential (IAS) algorithm.</p>
<p>The real data set used for this demo is the MEG sample data acquired with the Neuromag Vectorview system
at MGH/HMS/MIT Athinoula A. Martinos Center Biomedical Imaging and made available, together with the
MRI reconstructions created with FreeSurfer, in the <a href="http://martinos.org/mne/stable/index.html" target="_blank">MNE python</a> software package.</p>
<p>As part of the protocol for the data collection, checkerboard patterns were presented into the left
and right visual field, interspersed by tones to the left or right ear. The interval between the stimuli
was 750 ms. Occasionally a smiley face was presented at the center of the visual field. The subject
was asked to press a key with the right index finger as soon as possible after the appearance of the fac.e <a class="reference internal" href="#ref" id="id1"><span>[Ref]</span></a>
Here we only consider the trials corresponding to the left visual stimulus and perform the averaging on these trials.
The source space containing both cortical regions and subcortical structures
after discretization comprises 19054 vertices.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Click <a href="https://www.dropbox.com/s/6ho0w35y591lm24/IAS_data.tar.gz?dl=1" target="_blank">here</a> to download the data for IAS demo.</p>
</div>
<dl class="citation">
<dt class="label" id="ref"><span class="brackets"><a class="fn-backref" href="#id1">Ref</a></span></dt>
<dd><ol class="upperalpha simple">
<li><p>Gramfort et al, MNE software for processing MEG and EEG data, Neuroimage 86 (2014) 446-460</p></li>
</ol>
</dd>
</dl>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% Reset all</span><span class="w"></span>
<span class="nb">clear</span><span class="p">;</span><span class="w"> </span><span class="nb">clc</span><span class="p">;</span><span class="w"></span>
<span class="n">close</span><span class="w"> </span><span class="s">all</span><span class="w"></span>

<span class="c">%% Input</span><span class="w"></span>
<span class="c">%     SNR: estimated signal-to-noise ratio</span><span class="w"></span>
<span class="n">SNR</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span><span class="w"></span>
<span class="c">%     eta: scalar, parameter for selecting the focality of the reconstructed activity</span><span class="w"></span>
<span class="n">eta</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">;</span><span class="w"></span>
<span class="n">cut_off</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.9</span><span class="p">;</span><span class="w"></span>

<span class="c">%% Loading the source space</span><span class="w"></span>
<span class="c">%     coord, normals: (3,N) array, coordinates and normal vectors of the dipoles in the grid</span><span class="w"></span>
<span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Loading source space&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">load</span><span class="p">(</span><span class="s">&#39;SourceSpace_DBA&#39;</span><span class="p">)</span><span class="w"></span>

<span class="c">%% Loading the leadfield matrix</span><span class="w"></span>
<span class="c">%     LF: (M,3*N) array, the lead field matrix (M is the number of channels; N is the number of dipoles)</span><span class="w"></span>
<span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Loading leadfield matrix&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">load</span><span class="p">(</span><span class="s">&#39;LeadfieldMatrix_DBA&#39;</span><span class="p">)</span><span class="w"></span>

<span class="c">%% Loading the magnetic data</span><span class="w"></span>
<span class="c">%     data: (M,T) array, a set of data of length T</span><span class="w"></span>
<span class="c">%     time: T-vector, times</span><span class="w"></span>
<span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Loading data&#39;</span><span class="p">)</span><span class="w"></span>
<span class="nb">load</span><span class="p">(</span><span class="s">&#39;visualMEGData&#39;</span><span class="p">)</span><span class="w"></span>

<span class="c">%% Building anatomical prior</span><span class="w"></span>
<span class="p">:</span><span class="n">func</span><span class="p">:</span>`<span class="n">IAS</span><span class="p">.</span><span class="n">BuildAnatomicalPrior</span>`<span class="w"></span>
<span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Building anatomical prior&#39;</span><span class="p">)</span><span class="w"></span>
<span class="n">APChol</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">BuildAnatomicalPrior</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span><span class="n">normals</span><span class="p">);</span><span class="w"></span>

<span class="c">%% Setting theta_star and scaling</span><span class="w"></span>
<span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Setting parameters&#39;</span><span class="p">)</span><span class="w"></span>
<span class="n">t_peak</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">86</span><span class="p">;</span><span class="w"></span>
<span class="n">t_min</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="n">t_max</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">211</span><span class="p">;</span><span class="w"></span>
<span class="n">B</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">data</span><span class="p">(:,</span><span class="n">t_min</span><span class="p">:</span><span class="n">t_max</span><span class="p">);</span><span class="w"></span>
<span class="p">[</span><span class="n">theta_star</span><span class="p">,</span><span class="n">theta_cut_off</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">LF_scaling</span><span class="p">,</span><span class="n">B_scaling</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SetParameters</span><span class="p">(</span><span class="n">LF</span><span class="p">,</span><span class="n">APChol</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">SNR</span><span class="p">,</span><span class="n">cut_off</span><span class="p">);</span><span class="w"></span>

<span class="c">%% Solving the inverse problem using IAS algorithm</span><span class="w"></span>
<span class="nb">disp</span><span class="p">([</span><span class="s">&#39;Running IAS algorithm from time &#39;</span><span class="p">,</span><span class="nb">num2str</span><span class="p">(</span><span class="nb">time</span><span class="p">(</span><span class="n">t_min</span><span class="p">)),</span><span class="s">&#39; ms to time &#39;</span><span class="p">,</span><span class="nb">num2str</span><span class="p">(</span><span class="nb">time</span><span class="p">(</span><span class="n">t_max</span><span class="p">)),</span><span class="s">&#39; ms&#39;</span><span class="p">])</span><span class="w"></span>
<span class="n">Q</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">IAS_algorithm</span><span class="p">(</span><span class="n">LF</span><span class="p">,</span><span class="w"> </span><span class="n">LF_scaling</span><span class="p">,</span><span class="w"> </span><span class="n">APChol</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">B_scaling</span><span class="p">,</span><span class="w"> </span><span class="n">sigma</span><span class="p">,</span><span class="w"> </span><span class="n">theta_star</span><span class="p">,</span><span class="w"> </span><span class="n">eta</span><span class="p">);</span><span class="w"></span>

<span class="c">%% Visualizing the activity map</span><span class="w"></span>
<span class="nb">disp</span><span class="p">([</span><span class="s">&#39;Visualizing activity map at time &#39;</span><span class="p">,</span><span class="nb">num2str</span><span class="p">(</span><span class="nb">time</span><span class="p">(</span><span class="n">t_peak</span><span class="p">)),</span><span class="s">&#39; ms&#39;</span><span class="p">])</span><span class="w"></span>
<span class="n">N</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">size</span><span class="p">(</span><span class="n">LF</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">;</span><span class="w">  </span><span class="c">% number of dipoles in the source space</span><span class="w"></span>
<span class="n">t_vis</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">t_peak</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t_min</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="n">q</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Q</span><span class="p">(:,</span><span class="w"> </span><span class="n">t_vis</span><span class="p">);</span><span class="w"></span>
<span class="n">dip_norm2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="nb">reshape</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="n">Q_est</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">dip_norm2</span><span class="p">);</span><span class="w"></span>
<span class="n">SlicedVisualization_ActivityMap</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span><span class="n">Q_est</span><span class="p">);</span><span class="w"></span>

<span class="c">%% Visualazing the activity map and its maximum</span><span class="w"></span>
<span class="p">[</span><span class="n">Q_max</span><span class="p">,</span><span class="n">i_max</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="n">Q_est</span><span class="p">);</span><span class="w"></span>
<span class="n">r0</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">coord</span><span class="p">(:,</span><span class="n">i_max</span><span class="p">);</span><span class="w"></span>
<span class="n">SingleSliceVisualization_ActivityMap</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span><span class="n">Q_est</span><span class="p">,</span><span class="n">r0</span><span class="p">,</span><span class="s">&#39;CoordSystem&#39;</span><span class="p">,</span><span class="s">&#39;Brainstorm&#39;</span><span class="p">,</span><span class="s">&#39;ColorScale&#39;</span><span class="p">,</span><span class="s">&#39;double&#39;</span><span class="p">,</span><span class="s">&#39;Locator&#39;</span><span class="p">,</span><span class="s">&#39;pinhead&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<figure class="align-center" id="id2">
<img alt="_images/SingleSliceVisualization.jpg" src="_images/SingleSliceVisualization.jpg" />
<figcaption>
<p><span class="caption-text">Reconstructed activity map from real data at 92 ms</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p><strong>Download</strong> IAS Demo script: <code class="xref download docutils literal notranslate"><span class="pre">IAS_Demo.m</span></code></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="IAS algorithm" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api.html" class="btn btn-neutral float-right" title="API Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, IAS Developers. Last updated on 2022-05-02.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>